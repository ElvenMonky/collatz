#!/bin/bash

function check()
{
	T=$(./worker $1)

	CHECKSUM=$(echo "$T" | sed -unE '/CHECKSUM/s/.* (.*) .*/\1/p')
	MAXIMUM_OFFSET=$(echo "$T" | sed -unE '/MAXIMUM_OFFSET/s/.* (.*)/\1/p')
	MAXIMUM_CYCLE_OFFSET=$(echo "$T" | sed -unE '/MAXIMUM_CYCLE_OFFSET/s/.* (.*)/\1/p')

	echo "$CHECKSUM $MAXIMUM_OFFSET $MAXIMUM_CYCLE_OFFSET"
}

function verify()
{
	if test "$(check $1)" = "$2"; then
		echo "$1: PASSED"
	else
		echo "$1: FAILED"
	fi
}

echo "TEST USE_SIEVE=1 USE_PRECALC=1"
make clean all USE_SIEVE=1 USE_PRECALC=1 USE_LIBGMP=1

verify 98999215 "330684153073 626941880799 774712573087"
verify 98999216 "330685251240 585714939119 179472374087"
verify 98999217 "330685267527 981603428123 625267373159"
verify 98999218 "330685137688 371145336991 152337526527"
verify 98999219 "330682821619 30069329055 551992735199"
verify 98999220 "330684443074 705488991903 72345484027"
verify 98999221 "330684669313 8275696879 589522022399"

echo "TEST USE_SIEVE=1 USE_PRECALC=0"
make clean all USE_SIEVE=1 USE_PRECALC=0 USE_LIBGMP=1

verify 98999215 "330684153073 626941880799 774712573087"
verify 98999216 "330685251240 585714939119 179472374087"
verify 98999217 "330685267527 981603428123 625267373159"
verify 98999218 "330685137688 371145336991 152337526527"
verify 98999219 "330682821619 30069329055 551992735199"
verify 98999220 "330684443074 705488991903 72345484027"
verify 98999221 "330684669313 8275696879 589522022399"
